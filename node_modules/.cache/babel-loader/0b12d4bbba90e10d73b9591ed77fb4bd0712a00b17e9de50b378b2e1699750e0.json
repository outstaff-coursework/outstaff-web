{"ast":null,"code":"// adds Faro session id to every span\nexport class FaroSessionSpanProcessor {\n  constructor(processor, metas) {\n    this.processor = processor;\n    this.metas = metas;\n  }\n  forceFlush() {\n    return this.processor.forceFlush();\n  }\n  onStart(span, parentContext) {\n    const session = this.metas.value.session;\n    if (session === null || session === void 0 ? void 0 : session.id) {\n      span.attributes['session_id'] = session.id;\n    }\n    this.processor.onStart(span, parentContext);\n  }\n  onEnd(span) {\n    this.processor.onEnd(span);\n  }\n  shutdown() {\n    return this.processor.shutdown();\n  }\n}","map":{"version":3,"names":["FaroSessionSpanProcessor","constructor","processor","metas","forceFlush","onStart","span","parentContext","session","value","id","attributes","onEnd","shutdown"],"sources":["/home/egor/node_modules/@grafana/faro-web-tracing/src/sessionSpanProcessor.ts"],"sourcesContent":["import type { Context } from '@opentelemetry/api';\nimport type { ReadableSpan, Span, SpanProcessor } from '@opentelemetry/sdk-trace-web';\n\nimport type { Metas } from '@grafana/faro-web-sdk';\n\n// adds Faro session id to every span\nexport class FaroSessionSpanProcessor implements SpanProcessor {\n  constructor(\n    private processor: SpanProcessor,\n    private metas: Metas\n  ) {}\n\n  forceFlush(): Promise<void> {\n    return this.processor.forceFlush();\n  }\n\n  onStart(span: Span, parentContext: Context): void {\n    const session = this.metas.value.session;\n\n    if (session?.id) {\n      span.attributes['session_id'] = session.id;\n    }\n\n    this.processor.onStart(span, parentContext);\n  }\n\n  onEnd(span: ReadableSpan): void {\n    this.processor.onEnd(span);\n  }\n\n  shutdown(): Promise<void> {\n    return this.processor.shutdown();\n  }\n}\n"],"mappings":"AAKA;AACA,OAAM,MAAOA,wBAAwB;EACnCC,YACUC,SAAwB,EACxBC,KAAY;IADZ,KAAAD,SAAS,GAATA,SAAS;IACT,KAAAC,KAAK,GAALA,KAAK;EACZ;EAEHC,UAAUA,CAAA;IACR,OAAO,IAAI,CAACF,SAAS,CAACE,UAAU,EAAE;EACpC;EAEAC,OAAOA,CAACC,IAAU,EAAEC,aAAsB;IACxC,MAAMC,OAAO,GAAG,IAAI,CAACL,KAAK,CAACM,KAAK,CAACD,OAAO;IAExC,IAAIA,OAAO,aAAPA,OAAO,uBAAPA,OAAO,CAAEE,EAAE,EAAE;MACfJ,IAAI,CAACK,UAAU,CAAC,YAAY,CAAC,GAAGH,OAAO,CAACE,EAAE;;IAG5C,IAAI,CAACR,SAAS,CAACG,OAAO,CAACC,IAAI,EAAEC,aAAa,CAAC;EAC7C;EAEAK,KAAKA,CAACN,IAAkB;IACtB,IAAI,CAACJ,SAAS,CAACU,KAAK,CAACN,IAAI,CAAC;EAC5B;EAEAO,QAAQA,CAAA;IACN,OAAO,IAAI,CAACX,SAAS,CAACW,QAAQ,EAAE;EAClC"},"metadata":{},"sourceType":"module","externalDependencies":[]}